---
  - name : create data directory
    file: state=directory recurse=yes path=/mnt/elastic/data owner=deploy group=docker mode=0774

  - name : create log directory
    file: state=directory recurse=yes path=/mnt/elastic/logs owner=deploy group=docker mode=0774

  - name : create config directory
    file: state=directory recurse=yes path=/mnt/elastic/config owner=deploy group=docker mode=0774

  - name : copy es config template
    template: src=elasticsearch.j2 dest=/mnt/elastic/config/elasticsearch.yml owner=deploy group=docker mode=0774

  - name: elasticsearch container
    docker:
      name: esnode
      image: elasticsearch
      state: started
      expose:
        - 9200
        - 9300
      ports:
        - 9200
        - 9300
      volumes:
        - /mnt/elastic/data:/usr/share/elasticsearch/data
        - /mnt/elastic/logs:/usr/share/elasticsearch/logs
        - /mnt/elastic/config:/usr/share/elasticsearch/config